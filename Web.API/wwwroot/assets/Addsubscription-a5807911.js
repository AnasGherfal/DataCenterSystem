import{d as O,g as r,s as Q,h as B,v as X,u as Z,x as R,r as c,c as a,b as i,w as F,o as n,k as $,a as e,t as u,F as p,m as f,l as _,j as ee,y as te,z as v,A as D,U as oe,M as C,T as se,f as le}from"./index-8a7c54d3.js";import{_ as ae}from"./BackButton.vue_vue_type_script_setup_true_lang-3994efeb.js";import{u as ne}from"./subscriptions-39161759.js";import{u as ie}from"./customers-533e8710.js";import{s as re}from"./service-6188a30c.js";import{c as de}from"./customers-69672a1b.js";const ue=["onSubmit"],ce={class:"grid p-fluid"},me={class:"field col-12 md:col-6 lg:col-4"},pe={class:"p-float-label"},fe=e("label",{for:"customerName"},"العملاء",-1),_e={style:{height:"2px"}},ge={class:"field col-12 md:col-6 lg:col-4"},ve={class:"p-float-label"},he=e("label",{for:"startDate"},"تاريخ بداية الاشتراك",-1),ye={style:{height:"2px"}},De={class:"field col-12 md:col-6 lg:col-4"},be={class:"p-float-label"},Ie=e("label",{for:"endtDate"},"تاريخ انتهاء الاشتراك",-1),we={style:{height:"2px"}},Ve={class:"field col-12 md:col-6 lg:col-4"},$e={class:"p-float-label"},Ce=e("label",{for:"subscriptionType"},"الباقة",-1),Me={style:{height:"2px"}},xe={class:"field col-12 md:col-6 lg:col-4"},ke={class:"p-float-label"},Ye=e("label",{for:"number"},"رقم العقد",-1),Be={style:{height:"2px"}},Fe={class:"field col-12 md:col-6 lg:col-4"},Ne={class:"p-float-label"},Se=e("label",{for:"date"},"تاريخ العقد",-1),ze={style:{height:"2px"}},Te={class:"field col-12 md:col-6 lg:col-4"},Ae={class:"file-input-label",for:"fileInput1"},Ue={class:"file-input-content"},qe=e("div",{class:"file-input-icon"},null,-1),Le={class:"file-input-text"},Pe=e("i",{class:"pi pi-upload"},null,-1),Ee={key:0,style:{color:"red","font-weight":"bold","font-size":"small"}},Qe=O({__name:"Addsubscription",setup(je){const N=ne();ie();const g=r(!1),M=r(),h=r(null),S=r(1),z=r(1),T=r(10),A=r(0),y=r(""),b=r(),o=Q({serviceId:null,customerId:null,startDate:"",endDate:"",contractNumber:"",contractDate:"",file:null});B(async()=>{re.get().then(function(l){M.value=l.data.content}).catch(function(l){console.log(l)})}),B(async()=>{U()});async function U(){(y.value===void 0||y.value===null)&&(y.value=""),await de.get(z.value,T.value,y.value).then(function(l){b.value=l.data.content,S.value=l.data.totalPages,A.value=l.data.currentPage}).catch(function(l){console.log(l)}).finally(()=>{g.value=!1})}const q=X(()=>({customerId:{required:v.withMessage("الحقل مطلوب",D)},startDate:{required:v.withMessage("الحقل مطلوب",D)},endDate:{required:v.withMessage(" الحقل مطلوب",D),minValue:v.withMessage("تاريخ انتهاء الاشتراك يجب ان يكون بعد تاريخ البدايه",oe(o.startDate))},serviceId:{required:v.withMessage("الحقل مطلوب",D)}})),x=Z(),m=R(q,o);async function L(l,s){const d=l.target.files[0];d&&(o.file=d)}const P=async()=>{const l=await m.value.$validate();if(!o.file)return h.value="الحقل مطلوب";const s=new FormData;if(h.value="",!!l){if(g.value=!0,o.file===null){console.log("File is null");return}s.append("serviceId",String(o.serviceId)),s.append("customerId",String(o.customerId.id??0)),s.append("startDate",C(o.startDate).format("YYYY/MM/DD")),s.append("endDate",C(o.endDate).format("YYYY/MM/DD")),s.append("file",o.file),s.append("contractNumber",o.contractNumber),s.append("contractDate",C(o.contractDate).format("YYYY/MM/DD")),se.create(s).then(d=>{x.add({severity:"success",summary:"تمت اضافة اشتراك",detail:d.data.msg,life:3e3}),console.log(d),g.value=!1,N.getSubs(),le.go(-1)}).catch(function(d){console.log(d),x.add({severity:"error",summary:"هناك مشكلة",detail:d.response.data.msg||"هنالك مشكلة في الوصول",life:3e3})}),g.value=!1}},E=()=>{o.serviceId=null,o.customerId=null,o.startDate="",o.endDate="",o.file=null},I=r(new Date),w=r(),j=l=>{setTimeout(()=>{l.query.trim().length?w.value=b.value.filter(s=>s.name.toLowerCase().startsWith(l.query.toLowerCase())):w.value=[...b.value]},250)};return(l,s)=>{const d=c("Divider"),W=c("AutoComplete"),V=c("Calendar"),G=c("Dropdown"),H=c("InputText"),k=c("Button"),J=c("Toast"),K=c("Card");return n(),a("div",null,[i(K,null,{title:F(()=>[$(" إضافة اشتراك "),i(ae,{style:{float:"left"}}),i(d,{layout:"horizontal"})]),content:F(()=>{var Y;return[e("form",{onSubmit:te(P,["prevent"])},[e("div",ce,[e("div",me,[e("span",pe,[$(u()+" ",1),i(W,{modelValue:o.customerId,"onUpdate:modelValue":s[0]||(s[0]=t=>o.customerId=t),optionLabel:"name",suggestions:w.value,onComplete:j},null,8,["modelValue","suggestions"]),fe,e("div",_e,[(n(!0),a(p,null,f(_(m).customerId.$errors,t=>(n(),a("span",{style:{color:"red","font-weight":"bold","font-size":"small"},key:t.$uid,class:"p-error"},u(t.$message),1))),128))])])]),e("div",ge,[e("span",ve,[i(V,{inputId:"startDate",modelValue:o.startDate,"onUpdate:modelValue":s[1]||(s[1]=t=>o.startDate=t),minDate:I.value,dateFormat:"yy/mm/dd",selectionMode:"single",showButtonBar:!0,manualInput:!1},null,8,["modelValue","minDate"]),he,e("div",ye,[(n(!0),a(p,null,f(_(m).startDate.$errors,t=>(n(),a("span",{style:{color:"red","font-weight":"bold","font-size":"small"},key:t.$uid,class:"p-error"},u(t.$message),1))),128))])])]),e("div",De,[e("span",be,[i(V,{inputId:"endDate",modelValue:o.endDate,"onUpdate:modelValue":s[2]||(s[2]=t=>o.endDate=t),dateFormat:"yy/mm/dd",selectionMode:"single",minDate:I.value,showButtonBar:!0,manualInput:!1},null,8,["modelValue","minDate"]),Ie,e("div",we,[(n(!0),a(p,null,f(_(m).endDate.$errors,t=>(n(),a("span",{style:{color:"red","font-weight":"bold","font-size":"small"},key:t.$uid,class:"p-error"},u(t.$message),1))),128))])])]),e("div",Ve,[e("span",$e,[i(G,{id:"subscriptionType",options:M.value,"option-value":"id",optionLabel:"name",modelValue:o.serviceId,"onUpdate:modelValue":s[3]||(s[3]=t=>o.serviceId=t),placeholder:"اختر الباقه",emptyMessage:"لايوجد باقات"},null,8,["options","modelValue"]),Ce,e("div",Me,[(n(!0),a(p,null,f(_(m).serviceId.$errors,t=>(n(),a("span",{style:{color:"red","font-weight":"bold","font-size":"small"},key:t.$uid,class:"p-error"},u(t.$message),1))),128))])])]),e("div",xe,[e("span",ke,[i(H,{id:"number",modelValue:o.contractNumber,"onUpdate:modelValue":s[4]||(s[4]=t=>o.contractNumber=t)},null,8,["modelValue"]),Ye,e("div",Be,[(n(!0),a(p,null,f(_(m).serviceId.$errors,t=>(n(),a("span",{style:{color:"red","font-weight":"bold","font-size":"small"},key:t.$uid,class:"p-error"},u(t.$message),1))),128))])])]),e("div",Fe,[e("span",Ne,[i(V,{inputId:"endDate",modelValue:o.contractDate,"onUpdate:modelValue":s[5]||(s[5]=t=>o.contractDate=t),dateFormat:"yy/mm/dd",selectionMode:"single",minDate:I.value,showButtonBar:!0,manualInput:!1},null,8,["modelValue","minDate"]),Se,e("div",ze,[(n(!0),a(p,null,f(_(m).endDate.$errors,t=>(n(),a("span",{style:{color:"red","font-weight":"bold","font-size":"small"},key:t.$uid,class:"p-error"},u(t.$message),1))),128))])])]),e("div",Te,[e("label",Ae,[e("div",Ue,[qe,e("div",Le,[Pe,$(" "+u(((Y=o.file)==null?void 0:Y.name)||"ارفق ملف  1 "),1)])]),e("input",{id:"fileInput1",style:{display:"none"},type:"file",onChange:s[6]||(s[6]=t=>L(t,0)),accept:"*"},null,32)]),h.value?(n(),a("div",Ee,u(h.value),1)):ee("",!0)])]),i(k,{class:"p-button-primry",icon:"fa-solid fa-plus",label:"إضافة",type:"submit",loading:g.value},null,8,["loading"]),i(k,{onClick:E,icon:"fa-solid fa-delete-left",label:"مسح",class:"p-button-danger",style:{"margin-right":"0.5em"}}),i(J,{position:"bottom-right"})],40,ue)]}),_:1})])}}});export{Qe as default};
